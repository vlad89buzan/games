/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/js/app.js":
/*!***********************!*\
  !*** ./src/js/app.js ***!
  \***********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _modules_functions_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./modules/functions.js */ \"./src/js/modules/functions.js\");\n/* harmony import */ var _modules_game_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./modules/game.js */ \"./src/js/modules/game.js\");\n\r\n\r\n_modules_functions_js__WEBPACK_IMPORTED_MODULE_0__.isWebp();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n\n//# sourceURL=webpack://gulp-2022/./src/js/app.js?");

/***/ }),

/***/ "./src/js/modules/functions.js":
/*!*************************************!*\
  !*** ./src/js/modules/functions.js ***!
  \*************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"isWebp\": () => (/* binding */ isWebp)\n/* harmony export */ });\n/* Проверка поддержки webp, добавление класса webp или no-webp для HTML */\r\nfunction isWebp() {\r\n\t// Проверка поддержки webp\r\n\tfunction testWebP(callback) {\r\n\t\tlet webP = new Image();\r\n\t\twebP.onload = webP.onerror = function () {\r\n\t\t\tcallback(webP.height == 2);\r\n\t\t};\r\n\t\twebP.src = \"data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA\";\r\n\t}\r\n\t// Добавление класса _webp или _no-webp для HTML\r\n\ttestWebP(function (support) {\r\n\t\tlet className = support === true ? 'webp' : 'no-webp';\r\n\t\tdocument.documentElement.classList.add(className);\r\n\t});\r\n}\n\n//# sourceURL=webpack://gulp-2022/./src/js/modules/functions.js?");

/***/ }),

/***/ "./src/js/modules/game.js":
/*!********************************!*\
  !*** ./src/js/modules/game.js ***!
  \********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\nconst KEYS = {\n  LEFT: 37,\n  RIGHT: 39,\n  SPACE: 32,\n};\n\nlet game = {\n  running: true,\n  ctx: null,\n  platform: null,\n  ball: null,\n  blocks: [],\n  score: 0,\n  rows: 4,\n  cols: 8,\n  width: 640,\n  height: 360,\n  sprites: {\n    background: null,\n    ball: null,\n    platform: null,\n    block: null,\n  },\n  sounds: {\n    bump: null,\n  },\n  init() {\n    this.ctx = document.getElementById(\"mycanvas\").getContext(\"2d\");\n    this.setTextFont();\n    this.setEvents();\n  },\n  setTextFont() {\n    this.ctx.font = \"20px Arial\";\n    this.ctx.fillStyle = \"#FFFFFF\";\n  },\n  setEvents() {\n    window.addEventListener(\"keydown\", (e) => {\n      if (e.keyCode === KEYS.SPACE) {\n        this.platform.fire();\n      } else if (e.keyCode === KEYS.LEFT || e.keyCode === KEYS.RIGHT) {\n        this.platform.start(e.keyCode);\n      }\n    });\n    window.addEventListener(\"keyup\", (e) => {\n      this.platform.stop();\n    });\n  },\n  preload(callback) {\n    let loaded = 0;\n    let required = Object.keys(this.sprites).length;\n    required += Object.keys(this.sounds).length;\n\n    let onResourceLoad = () => {\n      ++loaded;\n      if (loaded >= required) {\n        callback();\n      }\n    };\n\n    this.preloadSprites(onResourceLoad);\n    this.preloadAudio(onResourceLoad);\n  },\n  preloadSprites(onResourceLoad) {\n    for (let key in this.sprites) {\n      this.sprites[key] = new Image();\n      this.sprites[key].src = \"img/\" + key + \".png\";\n      this.sprites[key].addEventListener(\"load\", onResourceLoad);\n    }\n  },\n  preloadAudio(onResourceLoad) {\n    for (let key in this.sounds) {\n      this.sounds[key] = new Audio(\"files/sounds/\" + key + \".mp3\");\n      this.sounds[key].addEventListener(\"canplaythrough\", onResourceLoad, {\n        once: true,\n      });\n    }\n  },\n  create() {\n    for (let row = 0; row < this.rows; row++) {\n      for (let col = 0; col < this.cols; col++) {\n        this.blocks.push({\n          active: true,\n          width: 60,\n          height: 20,\n          x: 64 * col + 65,\n          y: 24 * row + 35,\n        });\n      }\n    }\n  },\n  update() {\n    this.collideBlocks();\n    this.collidePlatform();\n    this.ball.collideWorldBounds();\n    this.platform.collideWorldBounds();\n    this.platform.move();\n    this.ball.move();\n  },\n  addScore() {\n    ++this.score;\n\n    if (this.score >= this.blocks.length) {\n      this.end(\"Вы победили\");\n    }\n  },\n  collideBlocks() {\n    for (let block of this.blocks) {\n      if (block.active && this.ball.collide(block)) {\n        this.ball.bumpBlock(block);\n        this.addScore();\n        this.sounds.bump.play();\n      }\n    }\n  },\n  collidePlatform() {\n    if (this.ball.collide(this.platform)) {\n      this.ball.bumpPlatform(this.platform);\n      this.sounds.bump.play();\n    }\n  },\n  run() {\n    if (this.running) {\n      window.requestAnimationFrame(() => {\n        this.update();\n        this.render();\n        this.run();\n      });\n    }\n  },\n  render() {\n    this.ctx.clearRect(0, 0, this.width, this.height);\n    this.ctx.drawImage(this.sprites.background, 0, 0);\n    this.ctx.drawImage(\n      this.sprites.ball,\n      this.ball.frame * this.ball.width,\n      0,\n      this.ball.width,\n      this.ball.height,\n      this.ball.x,\n      this.ball.y,\n      this.ball.width,\n      this.ball.height\n    );\n    this.ctx.drawImage(this.sprites.platform, this.platform.x, this.platform.y);\n    this.renderBlocks();\n    this.ctx.fillText(\"Score: \" + this.score, 15, 20);\n  },\n  renderBlocks() {\n    for (let block of this.blocks) {\n      if (block.active) {\n        this.ctx.drawImage(this.sprites.block, block.x, block.y);\n      }\n    }\n  },\n  start: function () {\n    this.init();\n    this.preload(() => {\n      this.create();\n      this.run();\n    });\n  },\n  end(message) {\n    this.running = false;\n    alert(message);\n    window.location.reload();\n  },\n  random(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n  },\n};\n\ngame.ball = {\n  dx: 0,\n  dy: 0,\n  frame: 0,\n  velocity: 3,\n  x: 320,\n  y: 280,\n  width: 20,\n  height: 20,\n  start() {\n    this.dy = -this.velocity;\n    this.dx = game.random(-this.velocity, this.velocity);\n    this.animate();\n  },\n  animate() {\n    setInterval(() => {\n      ++this.frame;\n      if (this.frame > 3) {\n        this.frame = 0;\n      }\n    }, 100);\n  },\n  move() {\n    if (this.dy) {\n      this.y += this.dy;\n    }\n    if (this.dx) {\n      this.x += this.dx;\n    }\n  },\n  collide(element) {\n    let x = this.x + this.dx;\n    let y = this.y + this.dy;\n\n    if (\n      x + this.width > element.x &&\n      x < element.x + element.width &&\n      y + this.height > element.y &&\n      y < element.y + element.height\n    ) {\n      return true;\n    }\n    return false;\n  },\n  collideWorldBounds() {\n    let x = this.x + this.dx;\n    let y = this.y + this.dy;\n\n    let ballLeft = x;\n    let ballRight = ballLeft + this.width;\n    let ballTop = y;\n    let ballBottom = ballTop + this.height;\n\n    let worldLeft = 0;\n    let worldRight = game.width;\n    let worldTop = 0;\n    let worldBottom = game.height;\n\n    if (ballLeft < worldLeft) {\n      this.x = 0;\n      this.dx = this.velocity;\n      game.sounds.bump.play();\n    } else if (ballRight > worldRight) {\n      this.x = worldRight - this.width;\n      this.dx = -this.velocity;\n      game.sounds.bump.play();\n    } else if (ballTop < worldTop) {\n      this.y = 0;\n      this.dy = this.velocity;\n      game.sounds.bump.play();\n    } else if (ballBottom > worldBottom) {\n      game.end(\"Вы проиграли\");\n    }\n  },\n  bumpBlock(block) {\n    this.dy *= -1;\n    block.active = false;\n  },\n  bumpPlatform(platform) {\n    if (platform.dx) {\n      this.x += platform.dx;\n    }\n\n    if (this.dy > 0) {\n      this.dy = -this.velocity;\n      let touchX = this.x + this.width / 2;\n      this.dx = this.velocity * platform.getTouchOffset(touchX);\n    }\n  },\n};\n\ngame.platform = {\n  velocity: 6,\n  dx: 0,\n  x: 280,\n  y: 300,\n  width: 100,\n  height: 14,\n  ball: game.ball,\n  fire() {\n    if (this.ball) {\n      this.ball.start();\n      this.ball = null;\n    }\n  },\n  start(direction) {\n    if (direction === KEYS.LEFT) {\n      this.dx = -this.velocity;\n    } else if (direction === KEYS.RIGHT) {\n      this.dx = this.velocity;\n    }\n  },\n  stop() {\n    this.dx = 0;\n  },\n  move() {\n    if (this.dx) {\n      this.x += this.dx;\n      if (this.ball) {\n        this.ball.x += this.dx;\n      }\n    }\n  },\n  getTouchOffset(x) {\n    let diff = this.x + this.width - x;\n    let offset = this.width - diff;\n    let result = (2 * offset) / this.width;\n    return result - 1;\n  },\n  collideWorldBounds() {\n    let x = this.x + this.dx;\n    let platformLeft = x;\n    let platformRight = platformLeft + this.width;\n    let worldLeft = 0;\n    let worldRight = game.width;\n\n    if (platformLeft < worldLeft || platformRight > worldRight) {\n      this.dx = 0;\n    }\n  },\n};\n\nwindow.addEventListener(\"load\", () => {\n  game.start();\n});\n\n\n//# sourceURL=webpack://gulp-2022/./src/js/modules/game.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/js/app.js");
/******/ 	
/******/ })()
;